# Proposed Feature Structure Specification

This document outlines a proposed directory and file structure for features generated by petrock. The goal is to provide a more modular, maintainable organization as features grow in complexity.

## Directory Structure

```
feature_template/
├── main.go            # Main feature package exports and initialization
│
├── assets/
│   └── keep.txt
│
├── commands/
│   ├── base.go                     # Common command interfaces and helpers
│   ├── create.go                   # Create commands
│   ├── update.go                   # Update commands  
│   ├── delete.go                   # Delete commands
│   ├── request_summary.go          # Request summary generation commands
│   ├── set_summary.go              # Set generated summary commands
│   └── fail_summary.go             # Failed summary generation commands
│
├── handlers/
│   ├── middleware.go  # Common middleware
│   ├── create/
│   │   ├── item.go
│   │   └── batch.go
│   ├── read/
│   │   ├── item.go
│   │   └── list.go
│   └── update/
│       ├── item.go
│       └── status.go
│
├── queries/
│   ├── base.go        # Common query interfaces
│   ├── list.go        # List queries
│   └── detail.go      # Detail queries
│
├── state/
│   ├── main.go        # Main state container and interfaces
│   ├── item.go        # Core item state
│   └── metadata.go    # Related metadata state
│
├── ui/
│   ├── components/    # Reusable UI components
│   │   ├── buttons.go
│   │   ├── forms.go
│   │   └── tables.go
│   ├── layouts/       # Page layouts
│   │   ├── main.go
│   │   └── modal.go
│   ├── pages/         # Complete page views
│   │   ├── list.go
│   │   ├── detail.go
│   │   └── edit.go
│   └── view.go        # Main view exports
│
├── routes/
│   ├── main.go        # Route registration
│   ├── api.go         # API routes
│   ├── web.go         # Web UI routes
│   └── webhooks.go    # Webhook routes
│
└── workers/
    ├── main.go        # Worker struct, registration and interfaces
    ├── state.go       # Worker state types and management
    ├── api.go         # External API interactions
    ├── handlers.go    # Command handlers
    └── processing.go  # Background processing logic
```

## Rationale

This structure provides several advantages:

1. **Organization by responsibility**: Code is grouped based on its functional responsibility
2. **Improved maintainability**: Related code is co-located, making it easier to find and modify
3. **Scalability**: The structure accommodates growth in each area without creating massive files
4. **Discoverability**: The directory structure clearly communicates the architecture
5. **Separation of concerns**: Distinct boundaries between different aspects of the feature

## Implementation Considerations

When transitioning to this structure:

1. The main package file (main.go) should re-export all necessary components to maintain compatibility
2. Cross-package references should use proper import paths
3. Common interfaces and types should be defined in the appropriate base.go files
4. Domain-specific implementations should go in specialized subdirectories

This approach maintains the command/query separation pattern and event sourcing model that's core to petrock while providing better organization for complex features.

## Comparison with Current Structure

The current feature template uses a flat directory structure with the following files:

```
feature_template/
├── assets.go
├── commands.go
├── execute.go
├── http.go
├── queries.go
├── query.go
├── register.go
├── routes.go
├── state.go
├── view.go
├── worker.go
└── assets/
    └── keep.txt
```

Here's how the files in the current structure map to the new structure:

| Current File | New Location | Notes |
|--------------|--------------|-------|
| `assets.go` | Remains at root level | Minor change, still handles asset registration |
| `commands.go` | `commands/` directory | Split into multiple files by command type |
| `execute.go` | `commands/` directory | Implementation logic moved alongside command definitions |
| `http.go` | `handlers/` directory | Split into multiple files by handler purpose |
| `queries.go` | `queries/` directory | Split into multiple files by query type |
| `query.go` | `queries/` directory | Implementation logic moved alongside query definitions |
| `register.go` | `main.go` | Registration logic centralized in main package file |
| `routes.go` | `routes/` directory | Split into multiple files by route type |
| `state.go` | `state/` directory | Split into multiple files by entity type |
| `view.go` | `ui/` directory | Split into multiple files by component purpose |
| `worker.go` | `workers/` directory | Split into multiple files by worker responsibility |

The key differences are:

1. **Flat vs. Hierarchical**: The current structure uses a flat organization with all files in the root directory, while the new structure introduces a hierarchy.

2. **File Size Management**: The current structure tends to produce large files as features grow (e.g., http.go at 784 lines, view.go at 623 lines). The new structure distributes this code across multiple smaller files.

3. **Domain Organization**: The new structure allows for domain-specific organization within each subsystem (commands, queries, etc.), making it easier to locate related functionality.

4. **Discoverability**: The directory structure itself communicates the architecture more clearly than the flat file structure.